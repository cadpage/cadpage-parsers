package net.anei.cadpage.parsers.SC;

import java.util.HashSet;
import java.util.Properties;
import java.util.Set;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import net.anei.cadpage.parsers.MsgInfo.Data;
import net.anei.cadpage.parsers.dispatch.DispatchOSSIParser;

public class SCLexingtonCountyAParser extends DispatchOSSIParser {

  public SCLexingtonCountyAParser() {
    super(CITY_CODES, "LEXINGTON COUNTY", "SC",
          "( CANCEL ADDR CITY | FYI? SRC? CALL ADDR! EMPTY? ( ( CH | X/Z CH | X/Z X/Z CH ) ( PLACE CITY | CITY | ) | ( CITY | X/Z CITY | X/Z X_PLACE CITY | X/Z X/Z PLACE CITY | X+? ) ) UNIT/C+? ) INFO+");
    setupGpsLookupTable(GPS_LOOKUP_TABLE);
  }

  @Override
  public String getFilter() {
    return "CAD@lex-co.com";
  }

  private Set<String> unitSet = null;

  @Override
  public boolean parseMsg(String subject, String body, Data data) {

    if (subject.equals("CAD")) {
      body = "CAD:" + body;
    } else if (body.startsWith("CAD\n")) {
      data.strSource = subject;
      body = "CAD:" + body.substring(4);
    } else return false;
    unitSet = new HashSet<>();
    return super.parseMsg(body, data);
  }

  @Override
  public String getProgram() {
    return "SRC? " + super.getProgram();
  }

  @Override
  public Field getField(String name) {
    if (name.equals("SRC")) return new SourceField("(?!MVC)[A-Z]{3,4}", true);
    if (name.equals("APT")) return new AptField("\\d{1,4}[A-Z]?|[A-Z]|", true);
    if (name.equals("ADDR")) return new MyAddressField();
    if (name.equals("X_PLACE")) return new MyCrossPlaceField();
    if (name.equals("CH")) return new ChannelField("OPS *\\d+", true);
    if (name.equals("UNIT")) return new MyUnitField();
    if (name.equals("INFO")) return new MyInfoField();
    return super.getField(name);
  }

  private class MyAddressField extends AddressField {
    @Override
    public void parse(String field, Data data) {
      field = MSPACE_PTN.matcher(field).replaceAll(" ");
      super.parse(field, data);
    }
  }

  private class MyCrossPlaceField extends Field {

    @Override
    public void parse(String field, Data data) {
      if (isValidAddress(field)) {
        data.strCross = field;
      } else {
        data.strPlace = field;
      }
    }

    @Override
    public String getFieldNames() {
      return "X PLACE";
    }
  }

  private class MyUnitField extends UnitField {
    public MyUnitField() {
      super("(?:IBAT|[A-Z]+\\d+|\\d{3})(?:,[A-Z0-9]+)*", true);
    }

    @Override
    public void parse(String field, Data data) {
      for (String unit : field.split(",")) {
        unit = unit.trim();
        if (unitSet.add(unit)) data.strUnit = append(data.strUnit, ",", unit);
      }
    }
  }

  private Pattern INFO_TRIM_PTN = Pattern.compile("[-* ]*(.*?)[-* ]*");
  private Pattern INFO_CH_PTN = Pattern.compile("OPS *\\d+", Pattern.CASE_INSENSITIVE);
  private class MyInfoField extends InfoField {
    @Override
    public void parse(String field, Data data) {
      Matcher match = INFO_TRIM_PTN.matcher(field);
      if (match.matches()) field = match.group(1);

      if (INFO_CH_PTN.matcher(field).matches()) {
        data.strChannel = field;
      } else {
        data.strSupp = append(data.strSupp, "\n", field);
      }
    }

    @Override
    public String getFieldNames() {
      return "CH INFO";
    }
  }

  private static final Pattern I_PTN = Pattern.compile(" I[- ]*(?=\\d)");
  private static final Pattern MSPACE_PTN = Pattern.compile(" {2,}");
  private static final Pattern I_20_26_PTN = Pattern.compile("(\\d{2,3})(\\d\\d) (\\d\\d [EW])(?: &.*)?");

  @Override
  protected String adjustGpsLookupAddress(String address) {
    address = I_PTN.matcher(address).replaceAll(" ");
    address = MSPACE_PTN.matcher(address).replaceAll(" ");
    Matcher match = I_20_26_PTN.matcher(address);
    if (match.matches()) {
      String mm = match.group(1);
      int dec = Integer.parseInt(match.group(2));
      if (dec >= 50) mm = Integer.toString(Integer.parseInt(mm)+1);
      address = mm + " " + match.group(3);
    }
    return address;
  }

  private static final Properties GPS_LOOKUP_TABLE = buildCodeTable(new String[]{
      "37 20",                                "+33.796521,-81.471337",
      "38 20",                                "+33.807833,-81.460559",
      "39 20",                                "+33.818890,-81.449192",
      "40 20",                                "+33.828163,-81.435913",
      "41 20",                                "+33.837301,-81.422582",
      "42 20",                                "+33.847296,-81.409940",
      "43 20",                                "+33.857192,-81.397318",
      "44 20",                                "+33.868653,-81.386676",
      "45 20",                                "+33.880337,-81.376558",
      "46 20",                                "+33.888953,-81.362586",
      "47 20",                                "+33.897536,-81.348646",
      "48 20",                                "+33.906110,-81.334744",
      "49 20",                                "+33.914433,-81.320490",
      "50 20",                                "+33.921162,-81.305055",
      "51 20",                                "+33.927082,-81.289327",
      "52 20",                                "+33.935197,-81.274980",
      "53 20",                                "+33.943137,-81.260362",
      "54 20",                                "+33.951070,-81.245686",
      "55 20",                                "+33.958544,-81.230907",
      "56 20",                                "+33.963778,-81.214629",
      "57 20",                                "+33.969878,-81.198919",
      "58 20",                                "+33.983341,-81.192632",
      "59 20",                                "+33.993030,-81.180969",
      "60 20",                                "+34.003278,-81.168789",
      "61 20",                                "+34.009591,-81.153434",
      "62 20",                                "+34.015936,-81.139654",
      "63 20",                                "+34.027377,-81.126181",
      "64 20",                                "+34.407194,-81.699492",
      "65 20",                                "+34.394731,-81.690772",
      "66 20",                                "+34.381889,-81.682774",
      "67 20",                                "+34.370512,-81.671726",
      "68 20",                                "+34.360065,-81.659644",
      "69 20",                                "+34.352203,-81.646034",
      "70 20",                                "+34.343805,-81.631419",
      "71 20",                                "+34.335541,-81.616990",
      "72 20",                                "+34.327344,-81.602655",
      "73 20",                                "+34.318835,-81.587876",
      "74 20",                                "+34.310567,-81.573472",
      "75 20",                                "+34.302058,-81.558710",
      "76 20",                                "+34.292722,-81.545175",
      "77 20",                                "+34.284775,-81.532098",
      "78 20",                                "+34.276329,-81.517924",
      "79 20",                                "+34.265845,-81.505579",
      "80 20",                                "+34.256073,-81.492765",
      "81 20",                                "+34.247464,-81.479181",
      "82 20",                                "+34.240023,-81.463912",
      "83 20",                                "+34.234742,-81.447731",
      "84 20",                                "+34.228053,-81.432252",
      "85 20",                                "+34.222257,-81.416445",
      "86 20",                                "+34.216380,-81.399855",
      "87 20",                                "+34.210222,-81.384711",
      "88 20",                                "+34.203359,-81.369081",
      "89 20",                                "+34.195282,-81.354703",
      "90 20",                                "+34.187387,-81.339795",
      "91 20",                                "+34.178810,-81.325572",
      "92 20",                                "+34.173023,-81.309836",
      "93 20",                                "+34.167619,-81.294131",
      "64 26",                                "+34.407194,-81.699492",
      "65 26",                                "+34.394731,-81.690772",
      "66 26",                                "+34.381889,-81.682774",
      "67 26",                                "+34.370512,-81.671726",
      "68 26",                                "+34.360065,-81.659644",
      "69 26",                                "+34.352203,-81.646034",
      "70 26",                                "+34.343805,-81.631419",
      "71 26",                                "+34.335541,-81.616990",
      "72 26",                                "+34.327344,-81.602655",
      "73 26",                                "+34.318835,-81.587876",
      "74 26",                                "+34.310567,-81.573472",
      "75 26",                                "+34.302058,-81.558710",
      "76 26",                                "+34.292722,-81.545175",
      "77 26",                                "+34.284775,-81.532098",
      "78 26",                                "+34.276329,-81.517924",
      "79 26",                                "+34.265845,-81.505579",
      "80 26",                                "+34.256073,-81.492765",
      "81 26",                                "+34.247464,-81.479181",
      "82 26",                                "+34.240023,-81.463912",
      "83 26",                                "+34.234742,-81.447731",
      "84 26",                                "+34.228053,-81.432252",
      "85 26",                                "+34.222257,-81.416445",
      "86 26",                                "+34.216380,-81.399855",
      "87 26",                                "+34.210222,-81.384711",
      "88 26",                                "+34.203359,-81.369081",
      "89 26",                                "+34.195282,-81.354703",
      "90 26",                                "+34.187387,-81.339795",
      "91 26",                                "+34.178810,-81.325572",
      "92 26",                                "+34.173023,-81.309836",
      "93 26",                                "+34.167619,-81.294131",
      "109 26",                               "+34.013984,-81.108085",
      "110 26",                               "+33.999722,-81.109000",
      "111 26",                               "+33.985673,-81.106932",
      "112 26",                               "+33.972853,-81.102856",
      "113 26",                               "+33.956236,-81.093152",
      "114 26",                               "+33.945402,-81.089566",
      "115 26",                               "+33.934362,-81.079126",
      "116 26",                               "+33.923583,-81.068039",
      "117 26",                               "+33.912644,-81.057452",
      "118 26",                               "+33.900419,-81.047774",
      "119 26",                               "+33.888044,-81.039042",
      "120 26",                               "+33.873681,-81.035910",
      "128 26",                               "+33.770990,-80.975264",
      "129 26",                               "+33.763811,-80.960550",
      "130 26",                               "+33.755147,-80.946714",
      "131 26",                               "+33.749788,-80.943194",
      "37 20 E",                              "+33.796521,-81.471337",
      "38 20 E",                              "+33.807870,-81.460400",
      "39 20 E",                              "+33.818890,-81.449192",
      "40 20 E",                              "+33.828110,-81.435900",
      "41 20 E",                              "+33.837220,-81.422500",
      "42 20 E",                              "+33.847220,-81.409900",
      "43 20 E",                              "+33.857220,-81.397200",
      "44 20 E",                              "+33.868640,-81.386400",
      "45 20 E",                              "+33.880360,-81.376500",
      "46 20 E",                              "+33.888900,-81.362500",
      "47 20 E",                              "+33.897300,-81.348500",
      "48 20 E",                              "+33.905980,-81.334500",
      "49 20 E",                              "+33.914462,-81.320403",
      "50 20 E",                              "+33.920820,-81.304900",
      "51 20 E",                              "+33.927330,-81.289100",
      "52 20 E",                              "+33.934890,-81.274800",
      "53 20 E",                              "+33.943010,-81.260100",
      "54 20 E",                              "+33.950900,-81.245600",
      "55 20 E",                              "+33.958230,-81.230800",
      "56 20 E",                              "+33.963810,-81.213700",
      "57 20 E",                              "+33.969750,-81.198800",
      "58 20 E",                              "+33.983460,-81.192600",
      "59 20 E",                              "+33.993080,-81.180900",
      "60 20 E",                              "+34.003150,-81.168700",
      "61 20 E",                              "+34.009320,-81.053300",
      "62 20 E",                              "+34.016020,-81.139500",
      "63 20 E",                              "+34.027430,-81.126100",
      "64 20 E",                              "+34.035839,-81.113682",
      "65 20 E",                              "+34.038570,-81.096100",
      "66 20 E",                              "+34.045050,-81.079900",
      "67 20 E",                              "+34.051600,-81.064400",
      "68 20 E",                              "+34.061440,-81.047900",
      "69 20 E",                              "+34.066279,-81.035700",
      "70 20 E",                              "+34.067820,-81.018300",
      "71 20 E",                              "+34.073697,-81.002979",
      "72 20 E",                              "+34.073110,-80.985600",
      "73 20 E",                              "+34.073510,-80.968100",
      "74 20 E",                              "+34.073720,-80.951200",
      "75 20 E",                              "+34.070548,-80.934261",
      "76 20 E",                              "+34.068630,-80.917300",
      "77 20 E",                              "+34.075730,-80.908000",
      "78 20 E",                              "+34.081910,-80.886900",
      "79 20 E",                              "+34.088200,-80.871200",
      "80 20 E",                              "+34.095070,-80.854600",
      "81 20 E",                              "+34.100790,-80.839700",
      "82 20 E",                              "+34.106460,-80.823500",
      "83 20 E",                              "+34.112090,-80.807800",
      "84 20 E",                              "+34.119800,-80.792700",
      "85 20 E",                              "+34.127400,-80.778000",
      "86 20 E",                              "+34.134880,-80.763000",
      "87 20 E",                              "+34.143530,-80.749000",
      "88 20 E",                              "+34.152770,-80.735600",
      "89 20 E",                              "+34.162120,-80.722200",
      "90 20 E",                              "+34.171950,-80.709300",
      "91 20 E",                              "+34.182800,-80.697800",
      "92 20 E",                              "+34.190430,-80.683300",
      "93 20 E",                              "+34.197710,-80.668400",
      "94 20 E",                              "+34.205080,-80.653300",
      "95 20 E",                              "+34.214550,-80.640100",
      "96 20 E",                              "+34.218660,-80.623500",
      "97 20 E",                              "+34.218260,-80.606600",
      "98 20 E",                              "+34.216240,-80.589000",
      "99 20 E",                              "+34.214340,-80.571700",
      "100 20 E",                             "+34.214340,-80.554300",
      "101 20 E",                             "+34.216300,-80.537400",
      "102 20 E",                             "+34.215430,-80.520000",
      "103 20 E",                             "+34.213830,-80.502800",
      "104 20 E",                             "+34.210040,-80.486000",
      "105 20 E",                             "+34.208630,-80.468800",
      "37 20 W",                              "+33.796744,-81.471519",
      "38 20 W",                              "+33.808080,-81.460700",
      "39 20 W",                              "+33.819169,-81.449444",
      "40 20 W",                              "+33.828430,-81.436200",
      "41 20 W",                              "+33.837800,-81.423200",
      "42 20 W",                              "+33.847750,-81.410500",
      "43 20 W",                              "+33.857530,-81.397600",
      "44 20 W",                              "+33.869040,-81.387000",
      "45 20 W",                              "+33.881000,-81.377100",
      "46 20 W",                              "+33.889250,-81.362700",
      "47 20 W",                              "+33.897810,-81.348900",
      "48 20 W",                              "+33.906620,-81.335000",
      "49 20 W",                              "+33.914880,-81.320800",
      "50 20 W",                              "+33.921270,-81.305100",
      "51 20 W",                              "+33.927590,-81.289400",
      "52 20 W",                              "+33.935700,-81.275100",
      "53 20 W",                              "+33.943440,-81.260400",
      "54 20 W",                              "+33.951470,-81.246100",
      "55 20 W",                              "+33.958560,-81.230900",
      "56 20 W",                              "+33.964010,-81.214700",
      "57 20 W",                              "+33.971080,-81.199000",
      "58 20 W",                              "+33.983460,-81.192900",
      "59 20 W",                              "+33.993310,-81.180900",
      "60 20 W",                              "+34.003310,-81.168600",
      "61 20 W",                              "+34.009610,-81.153400",
      "62 20 W",                              "+34.016190,-81.139800",
      "63 20 W",                              "+34.027550,-81.126400",
      "64 20 W",                              "+34.036070,-81.113800",
      "65 20 W",                              "+34.038870,-81.096100",
      "66 20 W",                              "+34.045270,-81.080000",
      "67 20 W",                              "+34.051740,-81.064500",
      "68 20 W",                              "+34.061644,-81.048093",
      "69 20 W",                              "+34.066510,-81.035700",
      "70 20 W",                              "+34.068000,-81.018700",
      "71 20 W",                              "+34.074070,-81.003000",
      "72 20 W",                              "+34.073360,-80.985700",
      "73 20 W",                              "+34.073850,-80.968300",
      "74 20 W",                              "+34.073890,-80.951000",
      "75 20 W",                              "+34.070770,-80.934100",
      "76 20 W",                              "+34.068630,-80.917300",
      "78 20 W",                              "+34.082160,-80.887100",
      "79 20 W",                              "+34.088790,-80.871400",
      "80 20 W",                              "+34.095280,-80.855700",
      "81 20 W",                              "+34.101160,-80.840000",
      "82 20 W",                              "+34.106780,-80.823800",
      "83 20 W",                              "+34.112290,-80.808000",
      "84 20 W",                              "+34.120090,-80.793000",
      "85 20 W",                              "+34.127610,-80.778200",
      "86 20 W",                              "+34.135280,-80.763300",
      "87 20 W",                              "+34.143820,-80.749400",
      "88 20 W",                              "+34.153350,-80.736100",
      "89 20 W",                              "+34.162650,-80.722800",
      "90 20 W",                              "+34.172220,-80.709700",
      "91 20 W",                              "+34.183040,-80.698200",
      "92 20 W",                              "+34.190840,-80.683600",
      "93 20 W",                              "+34.197290,-80.668000",
      "94 20 W",                              "+34.205370,-80.653500",
      "95 20 W",                              "+34.214710,-80.640100",
      "96 20 W",                              "+34.218990,-80.623600",
      "97 20 W",                              "+34.218670,-80.606800",
      "98 20 W",                              "+34.216740,-80.589100",
      "99 20 W",                              "+34.214840,-80.571600",
      "100 20 W",                             "+34.214720,-80.554500",
      "101 20 W",                             "+34.216810,-80.537400",
      "102 20 W",                             "+34.215950,-80.520000",
      "103 20 W",                             "+34.214390,-80.502700",
      "104 20 W",                             "+34.210600,-80.485800",
      "105 20 W",                             "+34.209310,-80.468600",
      "109 20 W",                             "+34.014215,-81.108396",
      "64 26 E",                              "+34.407105,-81.699696",
      "65 26 E",                              "+34.394740,-81.691062",
      "66 26 E",                              "+34.381862,-81.682924",
      "67 26 E",                              "+34.370477,-81.671876",
      "68 26 E",                              "+34.359994,-81.659762",
      "69 26 E",                              "+34.352070,-81.646000",
      "70 26 E",                              "+34.343734,-81.631537",
      "71 26 E",                              "+34.335480,-81.617100",
      "72 26 E",                              "+34.327238,-81.602816",
      "73 26 E",                              "+34.318720,-81.587962",
      "74 26 E",                              "+34.309178,-81.571357",
      "75 26 E",                              "+34.301996,-81.558817",
      "76 26 E",                              "+34.292669,-81.545293",
      "77 26 E",                              "+34.284713,-81.532195",
      "78 26 E",                              "+34.276285,-81.518053",
      "79 26 E",                              "+34.265783,-81.505729",
      "80 26 E",                              "+34.256011,-81.492883",
      "81 26 E",                              "+34.247375,-81.479299",
      "82 26 E",                              "+34.239934,-81.463966",
      "83 26 E",                              "+34.234636,-81.447806",
      "84 26 E",                              "+34.227982,-81.432359",
      "85 26 E",                              "+34.222088,-81.416552",
      "86 26 E",                              "+34.216291,-81.399952",
      "87 26 E",                              "+34.210124,-81.384818",
      "88 26 E",                              "+34.203235,-81.369242",
      "89 26 E",                              "+34.195282,-81.354703",
      "77 26 E",                              "+34.284640,-81.532000",
      "90 26 E",                              "+34.187290,-81.340100",
      "91 26 E",                              "+34.179090,-81.326000",
      "92 26 E",                              "+34.172579,-81.310072",
      "93 26 E",                              "+34.167330,-81.294000",
      "94 26 E",                              "+34.161360,-81.278000",
      "95 26 E",                              "+34.155440,-81.262100",
      "97 26 E",                              "+34.142600,-81.230900",
      "98 26 E",                              "+34.135346,-81.214918",
      "100 26 E",                             "+34.115870,-81.192500",
      "101 26 E",                             "+34.104200,-81.180500",
      "102 26 E",                             "+34.093280,-81.168600",
      "103 26 E",                             "+34.082220,-81.157200",
      "104 26 E",                             "+34.071090,-81.146200",
      "105 26 W",                             "+34.060260,-81.134943",
      "106 26 E",                             "+34.049360,-81.123100",
      "107 26 E",                             "+34.037990,-81.112000",
      "108 26 E",                             "+34.025140,-81.102900",
      "109 26 E",                             "+34.014120,-81.108400",
      "110 26 E",                             "+33.999520,-81.109500",
      "111 26 E",                             "+33.985760,-81.107300",
      "112 26 E",                             "+33.969200,-81.100900",
      "113 26 E",                             "+33.961270,-81.095600",
      "114 26 E",                             "+33.945330,-81.089900",
      "115 26 E",                             "+33.934040,-81.079200",
      "116 26 E",                             "+33.923330,-81.068500",
      "117 26 E",                             "+33.912500,-81.057700",
      "118 26 E",                             "+33.900710,-81.048400",
      "119 26 E",                             "+33.887870,-81.039400",
      "120 26 E",                             "+33.873700,-81.035900",
      "121 26 E",                             "+33.860160,-81.030400",
      "122 26 E",                             "+33.846220,-81.025500",
      "123 26 E",                             "+33.832230,-81.020800",
      "124 26 E",                             "+33.819170,-81.013300",
      "125 26 E",                             "+33.806780,-81.004400",
      "126 26 E",                             "+33.794249,-80.995754",
      "127 26 E",                             "+33.781650,-80.986700",
      "128 26 E",                             "+33.770810,-80.975500",
      "129 26 E",                             "+33.763570,-80.960800",
      "130 26 E",                             "+33.755070,-80.947000",
      "131 26 E",                             "+33.742182,-80.939029",
      "132 26 E",                             "+33.729200,-80.931300",
      "133 26 E",                             "+33.716270,-80.923500",
      "134 26 E",                             "+33.702950,-80.916600",
      "135 26 E",                             "+33.689670,-80.909800",
      "136 26 E",                             "+33.677051,-80.901161",
      "137 26 E",                             "+33.664520,-80.892400",
      "138 26 E",                             "+33.651870,-80.884200",
      "139 26 E",                             "+33.638410,-80.877900",
      "64 26 W",                              "+34.407371,-81.699331",
      "65 26 W",                              "+34.394873,-81.690590",
      "66 26 W",                              "+34.381969,-81.682667",
      "67 26 W",                              "+34.370592,-81.671619",
      "68 26 W",                              "+34.360154,-81.659569",
      "69 26 W",                              "+34.352310,-81.645900",
      "70 26 W",                              "+34.343920,-81.631344",
      "71 26 W",                              "+34.335640,-81.616900",
      "72 26 W",                              "+34.327344,-81.602655",
      "73 26 W",                              "+34.318963,-81.587790",
      "74 26 W",                              "+34.309470,-81.571100",
      "75 26 W",                              "+34.302218,-81.558656",
      "76 26 W",                              "+34.292819,-81.545089",
      "77 26 W",                              "+34.284899,-81.532012",
      "78 26 W",                              "+34.276471,-81.517827",
      "79 26 W",                              "+34.265783,-81.505729",
      "80 26 W",                              "+34.256206,-81.492706",
      "81 26 W",                              "+34.247588,-81.479127",
      "82 26 W",                              "+34.240183,-81.463858",
      "83 26 W",                              "+34.234875,-81.447710",
      "84 26 W",                              "+34.228222,-81.432209",
      "85 26 W",                              "+34.222470,-81.416381",
      "86 26 W",                              "+34.216575,-81.399801",
      "87 26 W",                              "+34.210417,-81.384647",
      "88 26 W",                              "+34.203519,-81.369006",
      "89 26 W",                              "+334.195548,-81.354596",
      "90 26 W",                              "+34.187580,-81.340000",
      "91 26 W",                              "+34.179370,-81.325900",
      "92 26 W",                              "+34.173023,-81.309836",
      "93 26 W",                              "+34.167610,-81.293900",
      "94 26 W",                              "+34.161650,-81.278000",
      "95 26 W",                              "+34.155630,-81.262000",
      "96 26 W",                              "+34.149870,-81.246600",
      "97 26 W",                              "+34.142860,-81.230800",
      "98 26 W",                              "+34.135613,-81.214790",
      "100 26 W",                             "+34.116120,-81.192300",
      "101 26 W",                             "+34.104570,-81.180400",
      "102 26 W",                             "+34.093540,-81.168400",
      "103 26 W",                             "+34.082390,-81.157000",
      "104 26 W",                             "+34.071490,-81.146000",
      "105 26 W",                             "+34.060411,-81.134729",
      "106 26 W",                             "+34.049730,-81.122900",
      "107 26 W",                             "+34.038240,-81.111600",
      "108 26 W",                             "+34.025060,-81.102600",
      "109 26 W",                             "+34.014000,-81.108000",
      "110 26 W",                             "+33.999760,-81.108900",
      "111 26 W",                             "+33.985790,-81.106900",
      "112 26 W",                             "+33.969360,-81.100300",
      "113 26 W",                             "+33.961380,-81.095100",
      "114 26 W",                             "+33.945370,-81.089500",
      "115 26 W",                             "+33.934360,-81.079100",
      "116 26 W",                             "+33.923410,-81.068900",
      "117 26 W",                             "+33.912740,-81.057500",
      "118 26 W",                             "+33.899370,-81.047700",
      "119 26 W",                             "+33.888070,-81.039000",
      "120 26 W",                             "+33.873825,-81.035621",
      "121 26 W",                             "+33.860110,-81.030000",
      "122 26 W",                             "+33.846130,-81.025200",
      "123 26 W",                             "+33.832346,-81.020510",
      "124 26 W",                             "+33.819464,-81.012989",
      "125 26 W",                             "+33.806820,-81.004100",
      "126 26 W",                             "+33.794320,-80.995400",
      "127 26 W",                             "+33.781730,-80.986400",
      "128 26 W",                             "+33.771078,-80.975328",
      "129 26 W",                             "+33.763840,-80.960500",
      "130 26 W",                             "+33.755120,-80.946600",
      "131 26 W",                             "+33.742280,-80.938600",
      "132 26 W",                             "+33.729396,-80.931021",
      "133 26 W",                             "+33.716360,-80.923200",
      "134 26 W",                             "+33.703010,-80.916300",
      "135 26 W",                             "+33.689730,-80.909400",
      "136 26 W",                             "+33.677203,-80.900839",
      "137 26 W",                             "+33.664570,-80.892100",
      "138 26 W",                             "+33.651910,-80.884000",
      "139 26 W",                             "+33.638380,-80.877300",
      "1 77 N",                               "+33.928630,-81.057600",
      "2 77 N",                               "+33.928820,-81.040100",
      "3 77 N",                               "+33.929100,-81.024100",
      "4 77 N",                               "+33.936200,-81.008900",
      "5 77 N",                               "+33.947340,-80.997700",
      "6 77 N",                               "+33.950420,-80.981900",
      "7 77 N",                               "+33.952500,-80.964900",
      "8 77 N",                               "+33.963310,-80.952700",
      "10 77 N",                              "+33.991930,-80.954700",
      "11 77 N",                              "+34.004450,-80.956700",
      "12 77 N",                              "+34.017200,-80.948800",
      "13 77 N",                              "+34.030060,-80.940700",
      "14 77 N",                              "+34.043370,-80.934400",
      "15 77 N",                              "+34.053320,-80.922500",
      "16 77 N",                              "+34.067460,-80.921900",
      "17 77 N",                              "+34.077960,-80.934500",
      "18 77 N",                              "+34.087200,-80.947600",
      "19 77 N",                              "+34.099070,-80.957400",
      "20 77 N",                              "+34.112710,-80.961900",
      "21 77 N",                              "+34.127720,-80.962200",
      "22 77 N",                              "+34.141220,-80.964400",
      "23 77 N",                              "+34.155270,-80.964100",
      "24 77 N",                              "+34.169570,-80.969300",
      "25 77 N",                              "+34.181510,-80.979400",
      "26 77 N",                              "+34.195160,-80.984800",
      "27 77 N",                              "+34.209100,-80.983700",
      "28 77 N",                              "+34.223080,-80.987400",
      "29 77 N",                              "+34.234940,-80.995300",
      "30 77 N",                              "+34.251250,-80.998800",
      "31 77 N",                              "+34.265670,-80.997600",
      "32 77 N",                              "+34.280010,-80.997200",
      "37 77 N",                              "+34.348870,-80.999900",
      "34 77 N",                              "+34.308780,-81.000100",
      "35 77 N",                              "+34.320460,-81.005400",
      "41 77 N",                              "+34.406420,-80.994400",
      "43 77 N",                              "+34.435240,-80.994200",
      "44 77 N",                              "+34.449490,-80.991800",
      "45 77 N",                              "+34.463880,-80.994600",
      "46 77 N",                              "+34.478130,-80.995700",
      "48 77 N",                              "+34.508960,-80.997500",
      "49 77 N",                              "+34.523630,-80.998900",
      "50 77 N",                              "+34.537890,-81.000500",
      "1 77 S",                               "+33.929990,-81.057800",
      "2 77 S",                               "+33.929040,-81.036400",
      "3 77 S",                               "+33.929490,-81.024300",
      "4 77 S",                               "+33.936440,-81.009300",
      "5 77 S",                               "+33.947590,-80.998200",
      "6 77 S",                               "+33.950900,-80.981700",
      "7 77 S",                               "+33.953570,-80.963000",
      "8 77 S",                               "+33.963260,-80.953200",
      "9 77 S",                               "+33.977580,-80.955000",
      "10 77 S",                              "+33.991460,-80.954900",
      "11 77 S",                              "+34.004660,-80.957300",
      "12 77 S",                              "+34.017340,-80.949200",
      "13 77 S",                              "+34.030240,-80.941200",
      "14 77 S",                              "+34.043640,-80.935300",
      "15 77 S",                              "+34.053300,-80.923100",
      "16 77 S",                              "+34.067070,-80.923600",
      "17 77 S",                              "+34.077540,-80.934800",
      "18 77 S",                              "+34.087020,-80.948000",
      "19 77 S",                              "+34.098400,-80.957900",
      "20 77 S",                              "+34.112750,-80.962500",
      "21 77 S",                              "+34.127410,-80.962700",
      "22 77 S",                              "+34.141060,-80.965000",
      "23 77 S",                              "+34.155020,-80.964700",
      "24 77 S",                              "+34.169190,-80.969700",
      "25 77 S",                              "+34.181000,-80.979900",
      "26 77 S",                              "+34.194980,-80.985300",
      "27 77 S",                              "+34.209090,-80.984500",
      "28 77 S",                              "+34.222770,-80.987800",
      "29 77 S",                              "+34.234680,-80.995700",
      "35 77 S",                              "+34.320530,-81.006000",
      "36 77 S",                              "+34.334940,-81.004200",
      "37 77 S",                              "+34.349060,-81.000400",
      "38 77 S",                              "+34.363190,-80.997000",
      "39 77 S",                              "+34.377740,-80.995900",
      "41 77 S",                              "+34.406560,-80.994900",
      "42 77 S",                              "+34.420890,-80.996200",
      "43 77 S",                              "+34.435280,-80.994800",
      "44 77 S",                              "+34.449660,-80.992500",
      "45 77 S",                              "+34.463820,-80.995100",
      "46 77 S",                              "+34.478170,-80.996200",
      "47 77 S",                              "+34.492610,-80.995900",
      "49 77 S",                              "+34.523190,-80.999400",
      "50 77 S",                              "+34.536820,-81.000900",
      "135 95 N",                             "+33.897940,-80.095400",
      "137 95 N",                             "+33.922270,-80.076600",
      "138 95 N",                             "+33.934120,-80.067200",
      "139 95 N",                             "+33.946480,-80.057600",
      "140 95 N",                             "+33.958050,-80.047100",
      "141 95 N",                             "+33.971060,-80.041400",
      "142 95 N",                             "+33.982570,-80.030200",
      "144 95 N",                             "+34.002350,-80.004800",
      "145 95 N",                             "+34.014950,-79.996500",
      "146 95 N",                             "+34.028960,-79.991200",
      "160 95 N",                             "+33.910710,-80.087000",
      "134 95 S",                             "+33.884030,-80.100300",
      "136 95 S",                             "+33.910960,-80.087500",
      "137 95 S",                             "+33.922700,-80.077300",
      "139 95 S",                             "+33.946760,-80.057900",
      "140 95 S",                             "+33.958300,-80.047500",
      "142 95 S",                             "+33.982910,-80.030500",
      "143 95 S",                             "+33.991940,-80.016900",
      "144 95 S",                             "+34.002620,-80.005200",
      "145 95 S",                             "+34.015040,-79.996800",
      "146 95 S",                             "+34.029030,-79.991500",
      "1 SC 277 N",                           "+34.028880,-81.035700",
      "2 SC 277 N",                           "+34.036360,-81.021700",
      "4 SC 277 N",                           "+34.052610,-80.993500",
      "5 SC 277 N",                           "+34.064950,-80.984000",
      "6 SC 277 N",                           "+34.073790,-80.969500",
      "7 SC 277 N",                           "+34.085430,-80.961000",
      "1 SC 277 S",                           "+34.029390,-81.035900",
      "2 SC 277 S",                           "+34.036750,-81.021700",
      "3 SC 277 S",                           "+34.046950,-81.009700",
      "4 SC 277 S",                           "+34.052860,-80.993700",
      "5 SC 277 S",                           "+34.065140,-80.984400",
      "6 SC 277 S",                           "+34.074010,-80.969900",
      "7 SC 277 S",                           "+34.085690,-80.961400"
  });

  private static final Properties CITY_CODES = buildCodeTable(new String[]{
      "BA", "BATESBURG",
      "BL", "BATESBURG LEESVILE",
      "CA", "CAYCE",
      "CH", "CHAPIN",
      "CO", "COLUMBIA",
      "GA", "GASTON",
      "GI", "GILBERT",
      "IR", "IRMO",
      "LE", "LEESVILLE",
      "LX", "LEXINGTON",
      "PE", "PELION",
      "PI", "PINE RIDGE",
      "SC", "SOUTH CONGAREE",
      "SU", "SUMMIT",
      "SP", "SPRINGDALE",
      "SW", "SWANSEA",
      "WC", "WEST COLUMBIA"
  });
}
